{
  "code": "import { VictoryBox, Gold, Tools, Admin, EventAdmin, Dialog, Effects, Task, Click, TimerAdmin } from \"../Frame/lwg\";\r\nimport ADManager, { TaT } from \"../../TJ/Admanager\";\r\nexport default class UIVictoryBox extends VictoryBox.VictoryBoxScene {\r\n    constructor() { super(); }\r\n    lwgOnAwake() {\r\n        ADManager.TAPoint(TaT.BtnShow, 'UIVictoryBox_BtnAgain_Bytedance');\r\n        ADManager.TAPoint(TaT.BtnShow, 'UIVictoryBox_Ads');\r\n        Gold.createGoldNode(629, 174);\r\n        if (VictoryBox._openVictoryBoxNum > 1) {\r\n            let arr = Tools.arrayRandomGetOut([0, 1, 2, 3, 4, 5, 6, 7, 8], 3);\r\n            for (let index = 0; index < arr.length; index++) {\r\n                const element = arr[index];\r\n                VictoryBox.setProperty('box' + arr[index], VictoryBox.BoxProperty.ads, true);\r\n            }\r\n        }\r\n        Tools.node_2DShowExcludedChild(this.var('Platform'), [Admin._platform]);\r\n    }\r\n    lwgOnEnable() {\r\n        for (let index = 0; index < VictoryBox._BoxArray.length; index++) {\r\n            let name = VictoryBox._BoxArray[index][VictoryBox.BoxProperty.name];\r\n            let arr = VictoryBox.getProperty(name, VictoryBox.BoxProperty.rewardNum);\r\n            let num = Tools.randomCountNumer(arr[0], arr[1], 1);\r\n            VictoryBox.setProperty(name, VictoryBox.BoxProperty.rewardNum, num);\r\n        }\r\n        this.self['BtnClose'].visible = false;\r\n        Laya.timer.once(2000, this, () => {\r\n            this.self['BtnClose'].visible = true;\r\n        });\r\n        TimerAdmin.frameRandomLoop(30, 50, this, () => {\r\n            let x = this.self['SceneContent'].width / 2 - 160;\r\n            Effects.blink_Star(this.self['SceneContent'], new Laya.Point(x, this.self['TopPic'].height / 2 + 80), 90, 70, 'Game/UI/UIVictoryBox/xingxing.png', 53, 52);\r\n        }, true);\r\n        TimerAdmin.frameRandomLoop(30, 50, this, () => {\r\n            let x = this.self['SceneContent'].width / 2 + 160;\r\n            Effects.blink_Star(this.self['SceneContent'], new Laya.Point(x, this.self['TopPic'].height / 2 + 80), 90, 70, 'Game/UI/UIVictoryBox/xingxing.png', 53, 52);\r\n        }, true);\r\n    }\r\n    lwgEventReg() {\r\n        EventAdmin.reg(VictoryBox.EventType.openBox, this, (dataSource) => {\r\n            console.log(dataSource, VictoryBox._canOpenNum);\r\n            if (VictoryBox._canOpenNum > 0) {\r\n                if (dataSource[VictoryBox.BoxProperty.ads]) {\r\n                    ADManager.ShowReward(() => {\r\n                        ADManager.TAPoint(TaT.BtnClick, 'Adboxvideo');\r\n                        this.getRewardFunc(dataSource);\r\n                    });\r\n                }\r\n                else {\r\n                    this.getRewardFunc(dataSource);\r\n                }\r\n            }\r\n            else {\r\n                Dialog.createHint_Middle(Dialog.HintContent[\"观看广告可以获得三次开宝箱次数！\"]);\r\n            }\r\n        });\r\n    }\r\n    getRewardFunc(dataSource) {\r\n        VictoryBox._alreadyOpenNum++;\r\n        let automan = false;\r\n        VictoryBox._canOpenNum--;\r\n        VictoryBox._selectBox = dataSource[VictoryBox.BoxProperty.name];\r\n        let diffX = dataSource.arrange % 3;\r\n        if (diffX == 0) {\r\n            diffX = 3;\r\n        }\r\n        let diffY = Math.floor(dataSource.arrange / 3 + 0.5);\r\n        let x = VictoryBox._BoxList.x + VictoryBox._BoxList.width / 3 * diffX - 45;\r\n        let y = VictoryBox._BoxList.y + VictoryBox._BoxList.height / 3 * diffY + 92;\r\n        Effects.createExplosion_Rotate(this.self, 25, x, y, 'star', 10, 15);\r\n        VictoryBox.setProperty(dataSource[VictoryBox.BoxProperty.name], VictoryBox.BoxProperty.openState, true);\r\n        if (!automan) {\r\n            Laya.timer.frameOnce(20, this, f => {\r\n                Gold.getGoldAni_Heap(Laya.stage, 15, 88, 69, 'Game/UI/Common/jinbi.png', new Laya.Point(Laya.stage.width / 2, Laya.stage.height / 2), new Laya.Point(Gold.GoldNode.x - 80, Gold.GoldNode.y), null, () => {\r\n                    let rewardNum = VictoryBox.getProperty(dataSource.name, VictoryBox.BoxProperty.rewardNum);\r\n                    Gold.addGold(rewardNum);\r\n                });\r\n            });\r\n        }\r\n        EventAdmin.notify(Task.EventType.victoryBox);\r\n    }\r\n    boxList_Update(cell, index) {\r\n        let dataSource = cell.dataSource;\r\n        let Num = cell.getChildByName('Num');\r\n        let Pic_Gold = cell.getChildByName('Pic_Gold');\r\n        let Pic_Box = cell.getChildByName('Pic_Box');\r\n        let BordPic = cell.getChildByName('BordPic');\r\n        if (!dataSource[VictoryBox.BoxProperty.openState]) {\r\n            if (dataSource[VictoryBox.BoxProperty.ads]) {\r\n                Pic_Box.skin = 'Game/UI/UIVictoryBox/baoxiang_adv.png';\r\n            }\r\n            else {\r\n                Pic_Box.skin = 'Game/UI/UIVictoryBox/baoxiang2.png';\r\n            }\r\n            Pic_Box.visible = true;\r\n            Pic_Gold.visible = false;\r\n            Num.visible = false;\r\n        }\r\n        else {\r\n            Pic_Box.visible = false;\r\n            Pic_Gold.visible = true;\r\n            Num.visible = true;\r\n            Num.text = dataSource[VictoryBox.BoxProperty.rewardNum];\r\n        }\r\n    }\r\n    lwgBtnClick() {\r\n        let Dot;\r\n        if (Admin._platform = Admin._platformTpye.Bytedance) {\r\n            Dot = this.var('Bytedance_Dot');\r\n        }\r\n        else if (Admin._platform = Admin._platformTpye.WeChat) {\r\n            Dot = this.var('WeChat_Dot');\r\n        }\r\n        var no = () => {\r\n            Admin._openScene(Admin.SceneName.UIVictory, this.self);\r\n        };\r\n        var again = (e) => {\r\n            ADManager.TAPoint(TaT.BtnClick, 'UIVictoryBox_BtnAgain_Bytedance');\r\n            if (VictoryBox._alreadyOpenNum < 9 && VictoryBox._adsMaxOpenNum > 0) {\r\n                ADManager.ShowReward(() => {\r\n                    Dialog.createHint_Middle(Dialog.HintContent[\"增加三次开启宝箱次数！\"]);\r\n                    VictoryBox._canOpenNum += 3;\r\n                    VictoryBox._adsMaxOpenNum -= 3;\r\n                });\r\n            }\r\n            else {\r\n                Dialog.createHint_Middle(Dialog.HintContent[\"没有宝箱领可以领了！\"]);\r\n            }\r\n        };\r\n        Click.on(Click.Type.largen, this.self['OPPO_BtnNo'], this, null, null, no);\r\n        Click.on(Click.Type.largen, this.self['OPPO_BtnAgain'], this, null, null, again);\r\n        Click.on(Click.Type.largen, this.self['Bytedance_BtnNo'], this, null, null, no);\r\n        Click.on(Click.Type.largen, this.self['Bytedance_BtnAgain'], this, null, null, again);\r\n        Click.on(Click.Type.largen, this.self['Bytedance_BtnSelect'], this, null, null, () => {\r\n            if (Dot.visible) {\r\n                Dot.visible = false;\r\n            }\r\n            else {\r\n                Dot.visible = true;\r\n            }\r\n        });\r\n        Click.on(Click.Type.largen, this.self['BtnClose'], this, null, null, no);\r\n    }\r\n    lwgOnUpdate() {\r\n        if (VictoryBox._canOpenNum > 0) {\r\n            this.var('Platform').visible = false;\r\n        }\r\n        else {\r\n            this.var('Platform').visible = true;\r\n        }\r\n    }\r\n    lwgOnDisable() {\r\n        Gold.GoldNode.removeSelf();\r\n    }\r\n}\r\n",
  "references": [
    "D:/Game/project/Who/Project/Who/src/script/Frame/lwg.ts",
    "D:/Game/project/Who/Project/Who/src/TJ/Admanager.ts"
  ]
}
