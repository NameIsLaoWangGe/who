{
  "code": "import { Admin, DrawCard, Click, Tools, EventAdmin, Animation2D, Effects, Share, Gold, TimerAdmin, Setting, Dialog, Backpack } from \"../Frame/lwg\";\r\nimport { Game3D } from \"./Game3D\";\r\nimport { Guide } from \"../Frame/Guide\";\r\nexport default class UIDrawCard extends DrawCard.DrawCardScene {\r\n    lwgOnAwake() {\r\n        Gold.goldAppear();\r\n        Setting.setBtnVinish();\r\n    }\r\n    lwgOnEnable() {\r\n        this.self['ResidueNum'].text = DrawCard._residueDraw.num.toString();\r\n        this.self['FreeAds'].value = (DrawCard._freeAds.num % 3).toString();\r\n        TimerAdmin.frameLoop(320, this, () => {\r\n            Animation2D.move_Simple(this.self['ReflectMask'], -263, -271, 399, 71, 800, 0, () => {\r\n                Animation2D.fadeOut(this.self['Reflect2'], 0, 1, 200, 0, () => {\r\n                    Animation2D.fadeOut(this.self['Reflect2'], 1, 0, 300, 0, () => {\r\n                    });\r\n                });\r\n            }, Laya.Ease.cubicInOut);\r\n        }, true);\r\n        TimerAdmin.frameRandomLoop(100, 160, this, () => {\r\n            Effects.light_SimpleInfinite(this.self, 360, 640, 720, 1280, 0, 'Game/UI/UIDrawCard/guang2.png', 0.01);\r\n        }, true);\r\n        TimerAdmin.frameLoop(8, this, () => {\r\n            if (!this['middleOff']) {\r\n                Effects.particle_AnnularInhalation(this.self['SceneContent'], new Laya.Point(this.self['Mirror'].x, this.self['Mirror'].y), [400, 500]);\r\n            }\r\n        });\r\n        TimerAdmin.loop(2000, this, () => {\r\n            Animation2D.bomb_LeftRight(this.self['BtnFree'], 1.1, 250);\r\n        }, true);\r\n        TimerAdmin.loop(3000, this, () => {\r\n            Animation2D.fadeOut(this.self['Logo2'], 1, 0.5, 200, 0, () => {\r\n                Animation2D.fadeOut(this.self['Logo2'], 0.5, 1, 100, 0, () => {\r\n                });\r\n            });\r\n        });\r\n        TimerAdmin.frameRandomLoop(30, 100, this, () => {\r\n            for (let index = 0; index < 1; index++) {\r\n                Laya.timer.once(index * 180, this, () => {\r\n                    Effects.aureole_Continuous(this.self['Guang3'], new Laya.Point(this.self['Guang3'].width / 2, this.self['Guang3'].height / 2), 150, 150, null, ['Game/UI/UIDrawCard/guang3.png'], 0, 0.02);\r\n                });\r\n            }\r\n        }, true);\r\n        TimerAdmin.frameLoop(1, this, () => {\r\n            this.self['Guang5'].rotation += 0.7;\r\n            this.self['Guang6'].rotation -= 0.3;\r\n        });\r\n    }\r\n    lwgOpenAniAfter() {\r\n        Game3D.Scene3D.active = false;\r\n    }\r\n    lwgEventReg() {\r\n        EventAdmin.reg(Guide.EventType.start, this, () => {\r\n        });\r\n        let Img = this.self['Surface'];\r\n        let globalPos = Img.localToGlobal(new Laya.Point(Img.width / 2, Img.height / 2));\r\n        EventAdmin.reg('drawCardEvent', this, () => {\r\n            if (DrawCard._residueDraw.num <= 0) {\r\n                Dialog.createHint_Middle(Dialog.HintContent[\"没有抽奖次数了，请通过观看广告获取！\"]);\r\n                return;\r\n            }\r\n            else {\r\n                DrawCard._residueDraw.num--;\r\n                this.self['ResidueNum'].text = DrawCard._residueDraw.num.toString();\r\n            }\r\n            DrawCard._drawCount.num++;\r\n            let cardObjArr = [];\r\n            let SROrSSR;\r\n            if (DrawCard._drawCount.num == 1) {\r\n                cardObjArr = Tools.arrayRandomGetOut(Game3D.getCardObjByQuality(Game3D.Quality.R), 9);\r\n                if (Tools.randomNumber(10) >= 8) {\r\n                    SROrSSR = Tools.arrayRandomGetOut(Game3D.getCardObjByQuality(Game3D.Quality.SSR))[0];\r\n                }\r\n                else {\r\n                    SROrSSR = Tools.arrayRandomGetOut(Game3D.getCardObjByQuality(Game3D.Quality.SR))[0];\r\n                }\r\n                cardObjArr.push(SROrSSR);\r\n            }\r\n            else if (DrawCard._drawCount.num == 2) {\r\n                cardObjArr = Tools.arrayRandomGetOut(Game3D.getQualityObjArrByNameArr(Backpack._noHaveCard.arr, Game3D.Quality.R), 9);\r\n                if (Tools.randomNumber(10) >= 8) {\r\n                    SROrSSR = Tools.arrayRandomGetOut(Game3D.getQualityObjArrByNameArr(Backpack._noHaveCard.arr, Game3D.Quality.SR))[0];\r\n                }\r\n                else {\r\n                    SROrSSR = Tools.arrayRandomGetOut(Game3D.getQualityObjArrByNameArr(Backpack._noHaveCard.arr, Game3D.Quality.SSR))[0];\r\n                }\r\n                cardObjArr.push(SROrSSR);\r\n            }\r\n            else {\r\n                cardObjArr = Tools.arrayRandomGetOut(Game3D.getCardObjByQuality(Game3D.Quality.R), 9);\r\n                if (Tools.randomNumber(10) >= 8) {\r\n                    SROrSSR = Tools.arrayRandomGetOut(Game3D.getCardObjByQuality(Game3D.Quality.SSR))[0];\r\n                }\r\n                else {\r\n                    SROrSSR = Tools.arrayRandomGetOut(Game3D.getCardObjByQuality(Game3D.Quality.SR))[0];\r\n                }\r\n                cardObjArr.push(SROrSSR);\r\n                let equalNameArr = Tools.array_ExcludeArrays([Game3D.getNameArrByObjArr(cardObjArr), Backpack._haveCardArray.arr]);\r\n                this['repetitionCardNum'] = equalNameArr.length;\r\n                for (let i = 0; i < cardObjArr.length; i++) {\r\n                    for (let j = 0; j < equalNameArr.length; j++) {\r\n                        if (cardObjArr[i][Game3D.CardProperty.name] == equalNameArr[j]) {\r\n                            cardObjArr[i]['repetitionCard'] = true;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            Backpack._haveCardArray.add(Game3D.getNameArrByObjArr(cardObjArr));\r\n            cardObjArr = Tools.arrayRandomGetOut(cardObjArr, cardObjArr.length);\r\n            Admin._clickLock.switch = true;\r\n            this.self['DrawDisPlay'].x = 0;\r\n            this.self['BtnTake'].visible = false;\r\n            this.self['DrawDisPlayBg'].alpha = 0;\r\n            this.self['Guang5'].alpha = 0;\r\n            this.self['Guang6'].alpha = 0;\r\n            for (let index = 0; index < 10; index++) {\r\n                Laya.timer.once(index * 100, this, () => {\r\n                    let Card = Laya.Pool.getItemByCreateFun('Card', this.Card.create, this.Card);\r\n                    Card['objData'] = cardObjArr[index];\r\n                    let Back = Card.getChildByName('Back');\r\n                    Back.skin = 'Game/UI/UIDrawCard/' + Card['objData'][Game3D.CardProperty.quality] + '.png';\r\n                    this.self['CardParent'].addChild(Card);\r\n                    let spcing = (this.self['CardParent'].width - 5 * Card.width) / 6;\r\n                    Card.pos(globalPos.x, globalPos.y);\r\n                    Card.scale(0, 0);\r\n                    Card.name = 'Card' + index;\r\n                    Card.zOrder = 0;\r\n                    let Pic = Card.getChildByName('Pic');\r\n                    Pic.skin = 'Game/UI/UIDrawCard/Card/' + Card['objData'][Game3D.CardProperty.name] + '.jpg';\r\n                    Pic.visible = false;\r\n                    let x, y;\r\n                    if (index <= 4) {\r\n                        x = (spcing + Card.width / 2) + (Card.width + spcing) * index;\r\n                        y = globalPos.y - 100;\r\n                    }\r\n                    else {\r\n                        x = (spcing + Card.width / 2) + (Card.width + spcing) * (index - 5);\r\n                        y = globalPos.y + 100;\r\n                    }\r\n                    Animation2D.move_Scale(Card, 0, globalPos.x, globalPos.y, x, y, 1, 200, 0, Laya.Ease.expoIn);\r\n                    if (index == 3) {\r\n                        Animation2D.fadeOut(this.self['DrawDisPlayBg'], 0, 0.7, 500, 0, () => {\r\n                            Animation2D.fadeOut(this.self['Guang5'], 0, 1, 500);\r\n                            Animation2D.fadeOut(this.self['Guang6'], 0, 1, 500);\r\n                        });\r\n                    }\r\n                    else if (index == 9) {\r\n                        EventAdmin.notify('flop');\r\n                        Admin._clickLock.switch = false;\r\n                    }\r\n                });\r\n            }\r\n        });\r\n        EventAdmin.reg('flop', this, () => {\r\n            if (!this.self['cardIndex']) {\r\n                this.self['cardIndex'] = 0;\r\n            }\r\n            let Card = this.self['CardParent'].getChildByName('Card' + this.self['cardIndex']);\r\n            if (!Card) {\r\n                this.self['cardIndex'] = null;\r\n                Laya.timer.once(500, this, () => {\r\n                    Admin._openScene(Admin.SceneName.UIShare, null, () => { Share._fromWhich = Admin.SceneName.UIDrawCard; });\r\n                });\r\n                return;\r\n            }\r\n            var func = () => {\r\n                this.self['cardIndex']++;\r\n                EventAdmin.notify('flop');\r\n            };\r\n            Animation2D.cardRotateX_OneFace(Card, () => {\r\n                Card.getChildByName('Pic').visible = true;\r\n                if (!Card['objData']['repetitionCard']) {\r\n                    let New = Card.getChildByName('New');\r\n                    New.visible = true;\r\n                    Animation2D.bombs_Appear(New, 0, 1, 1.1, 5, 100, 200, 250);\r\n                }\r\n            }, 100, 50, () => {\r\n                if (Card['objData'][Game3D.CardProperty.quality] == Game3D.Quality.SR || Card['objData'][Game3D.CardProperty.quality] == Game3D.Quality.SSR) {\r\n                    Card.zOrder = (this.self['cardIndex'] + 1) * 10;\r\n                    let x = Card.x;\r\n                    let y = Card.y;\r\n                    let ReflectPic = Card.getChildByName('Reflect');\r\n                    TimerAdmin.frameRandomLoop(15, 35, this, () => {\r\n                        for (let index = 0; index < 1; index++) {\r\n                            Laya.timer.once(index * 200, this, () => {\r\n                                Effects.aureole_Continuous(Card, new Laya.Point(Card.width / 2, Card.height / 2), 41.5, 55, null, ['Frame/Effects/ui_square_guang2.png'], 0.1, 0.002);\r\n                            });\r\n                        }\r\n                    }, true);\r\n                    Animation2D.leftRight_Shake(Card, 20, 100, 300, () => {\r\n                        Animation2D.rotate_Scale(Card, 0, 1, 1, 720, 3, 3, 400, 200, () => {\r\n                            Animation2D.move_Simple(ReflectPic.getChildByName('LiuGuang'), -21, -9, 131, 180, 500, 400, () => {\r\n                                Animation2D.fadeOut(ReflectPic.getChildByName('Guang'), 0, 1, 250, 0, () => {\r\n                                    Animation2D.fadeOut(ReflectPic.getChildByName('Guang'), 1, 0, 200, 0);\r\n                                });\r\n                            }, Laya.Ease.expoIn);\r\n                            for (let index = 0; index < 5; index++) {\r\n                                let pointAarr = Tools.point_RandomPointByCenter(new Laya.Point(globalPos.x, globalPos.y), 200, 100);\r\n                                Laya.timer.once(300 * index, this, () => {\r\n                                    Effects.createExplosion_Rotate(this.self['CardParent'], 25, pointAarr[0].x, pointAarr[0].y, 'star', 10, 10);\r\n                                });\r\n                            }\r\n                            Animation2D.move_Scale(Card, 3, Card.x, Card.y, x, y, 1, 200, 2000, null, () => {\r\n                                func();\r\n                            });\r\n                        });\r\n                        Animation2D.move_Simple(Card, x, y, globalPos.x, globalPos.y, 250, 100);\r\n                    });\r\n                }\r\n                else {\r\n                    func();\r\n                }\r\n            });\r\n        });\r\n        EventAdmin.reg(Admin.SceneName.UIShare + Admin.SceneName.UIDrawCard, this, () => {\r\n            this.self['BtnTake'].visible = true;\r\n            EventAdmin.notify(Guide.EventType.onStep);\r\n        });\r\n    }\r\n    lwgBtnClick() {\r\n        Click.on(Click.Type.largen, this.self['BtnFree'], this, null, null, () => {\r\n            if (!Guide._complete.bool) {\r\n                return;\r\n            }\r\n            DrawCard._freeAds.num++;\r\n            if (DrawCard._freeAds.num % 3 == 0 && DrawCard._freeAds.num !== 0) {\r\n                DrawCard._freeAds.num = 0;\r\n                DrawCard._residueDraw.num++;\r\n                this.self['ResidueNum'].text = DrawCard._residueDraw.num.toString();\r\n            }\r\n            this.self['FreeAds'].value = (DrawCard._freeAds.num % 3).toString();\r\n        });\r\n        Click.on(Click.Type.largen, this.self['BtnBack'], this, null, null, () => {\r\n            if (!Guide._complete.bool) {\r\n                if (Guide._whichStepNum == 5) {\r\n                    Admin._openScene(Admin.SceneName.UIStart, this.self, null, Laya.stage.numChildren - 3);\r\n                    EventAdmin.notify(Guide.EventType.stepComplete);\r\n                }\r\n                return;\r\n            }\r\n            else {\r\n                Admin._openScene(Admin.SceneName.UIStart, this.self);\r\n            }\r\n        });\r\n        Click.on(Click.Type.noEffect, this.self['DrawDisPlay'], this, (e) => {\r\n            e.stopPropagation();\r\n        });\r\n        Click.on(Click.Type.largen, this.self['BtnTake'], this, null, null, (e) => {\r\n            EventAdmin.notify(Guide.EventType.stepComplete);\r\n            Admin._clickLock.switch = true;\r\n            let arrRepetitionCard = [];\r\n            let arrCard = [];\r\n            for (let index = 0; index < this.self['CardParent'].numChildren; index++) {\r\n                let Card = this.self['CardParent'].getChildAt(index);\r\n                if (Card['objData']['repetitionCard']) {\r\n                    arrRepetitionCard.push(Card);\r\n                }\r\n                else {\r\n                    arrCard.push(Card);\r\n                }\r\n            }\r\n            var anifunc = () => {\r\n                Animation2D.fadeOut(this.self['DrawDisPlay'], 1, 0, 200, 0, () => {\r\n                    EventAdmin.notify(Guide.EventType.onStep);\r\n                    this.self['DrawDisPlay'].x = -800;\r\n                    this.self['DrawDisPlay'].alpha = 1;\r\n                    Admin._clickLock.switch = false;\r\n                });\r\n                Tools.node_RemoveAllChildren(this.self['CardParent']);\r\n            };\r\n            var arrCardAni = () => {\r\n                for (let i = 0; i < arrCard.length; i++) {\r\n                    const Card = arrCard[i];\r\n                    let globalPos = Card.localToGlobal(new Laya.Point(Card.width / 2, Card.height / 2));\r\n                    Laya.timer.once(i * 150, this, () => {\r\n                        Animation2D.move_Simple(Card, Card.x, globalPos.y, Card.x, -300, 800, 0, () => {\r\n                            if (i == arrCard.length - 1) {\r\n                                anifunc();\r\n                            }\r\n                        }, Laya.Ease.cubicOut);\r\n                    });\r\n                }\r\n            };\r\n            var arrRepetitionCardAni = () => {\r\n                for (let j = 0; j < arrRepetitionCard.length; j++) {\r\n                    const Card = arrRepetitionCard[j];\r\n                    let globalPos = Card.localToGlobal(new Laya.Point(Card.width / 2, Card.height / 2));\r\n                    Laya.timer.once((j + 1) * 150, this, () => {\r\n                        Effects.createExplosion_Rotate(this.self['CardParent'], 25, globalPos.x, globalPos.y, Effects.SkinStyle.dot, 10, 10);\r\n                        Card.visible = false;\r\n                        Gold.getGoldAni_Heap(Laya.stage, 8, 88, 69, 'Game/UI/Common/jinbi.png', new Laya.Point(globalPos.x, globalPos.y), new Laya.Point(Gold.GoldNode.x - 80, Gold.GoldNode.y), null, () => {\r\n                            Gold.addGold(Card['objData'][Game3D.CardProperty.repetition]);\r\n                            if (j == arrRepetitionCard.length - 1) {\r\n                                if (j == 9) {\r\n                                    anifunc();\r\n                                }\r\n                                else {\r\n                                    arrCardAni();\r\n                                }\r\n                            }\r\n                        });\r\n                    });\r\n                }\r\n            };\r\n            if (arrRepetitionCard.length == 0) {\r\n                arrCardAni();\r\n            }\r\n            else {\r\n                arrRepetitionCardAni();\r\n            }\r\n        });\r\n        Click.on(Click.Type.noEffect, this.self['Surface'], this, (e) => {\r\n            EventAdmin.notify(Guide.EventType.stepComplete);\r\n            if (!this.self.getChildByName('DrawSp')) {\r\n                this.self['Drawlength'] = 0;\r\n                let DrawSp = new Laya.Sprite();\r\n                this.self.addChild(DrawSp);\r\n                DrawSp.name = 'DrawSp';\r\n                DrawSp.pos(0, 0);\r\n                this.self['DrawSp'] = DrawSp;\r\n            }\r\n            this.self['DrawPosArr'] = new Laya.Point(e.stageX, e.stageY);\r\n            this['middleOff'] = true;\r\n        }, (e) => {\r\n            let Img = this.self['Surface'];\r\n            let globalPos = Img.localToGlobal(new Laya.Point(Img.width / 2, Img.height / 2));\r\n            if (new Laya.Point(e.stageX, e.stageY).distance(globalPos.x, globalPos.y) > Img.width / 2) {\r\n                this.self['DrawPosArr'] = null;\r\n                return;\r\n            }\r\n            if (this.self['DrawPosArr']) {\r\n                this.self['DrawSp'].graphics.drawLine(this.self['DrawPosArr'].x, this.self['DrawPosArr'].y, e.stageX, e.stageY, \"#000000\", 8);\r\n                this.self['DrawSp'].graphics.drawCircle(e.stageX, e.stageY, 4, \"#000000\");\r\n                this.self['Drawlength'] += this.self['DrawPosArr'].distance(e.stageX, e.stageY);\r\n                this.self['DrawPosArr'] = new Laya.Point(e.stageX, e.stageY);\r\n            }\r\n        }, () => {\r\n            if (this.self.getChildByName('DrawSp')) {\r\n                this.self.getChildByName('DrawSp').removeSelf();\r\n            }\r\n            else {\r\n                return;\r\n            }\r\n            EventAdmin.notify('drawCardEvent');\r\n            this.self['DrawPosArr'] = null;\r\n            this['middleOff'] = false;\r\n        }, () => {\r\n            if (this.self.getChildByName('DrawSp')) {\r\n                this.self.getChildByName('DrawSp').removeSelf();\r\n            }\r\n            else {\r\n                return;\r\n            }\r\n            EventAdmin.notify('drawCardEvent');\r\n            this.self['DrawPosArr'] = null;\r\n            this['middleOff'] = false;\r\n        });\r\n    }\r\n    lwgBeforeVanishAni() {\r\n        Game3D.Scene3D.active = true;\r\n    }\r\n    ;\r\n    lwgOnDisable() {\r\n        Setting.setBtnAppear();\r\n    }\r\n}\r\n",
  "references": [
    "D:/Game/project/Who/Project/Who/src/script/Frame/lwg.ts",
    "D:/Game/project/Who/Project/Who/src/TJ/Admanager.ts",
    "D:/Game/project/Who/Project/Who/src/script/Game/Game3D.ts",
    "D:/Game/project/Who/Project/Who/src/script/Frame/Guide.ts"
  ]
}
