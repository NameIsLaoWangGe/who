{
  "code": "import { lwg, Dialog, VictoryBox, EventAdmin, Effects, Gold, Click, Task, Tools } from \"../Lwg_Template/lwg\";\r\nimport ADManager, { TaT } from \"../TJ/Admanager\";\r\nimport { EasterEgg } from \"../Lwg_Template/EasterEgg\";\r\nexport default class UIVictoryBox extends VictoryBox.VictoryBoxScene {\r\n    constructor() { super(); }\r\n    victoryBoxOnAwake() {\r\n        ADManager.TAPoint(TaT.BtnShow, 'Adboxvideo');\r\n        ADManager.TAPoint(TaT.BtnShow, 'Adboxagain');\r\n        this.self['BtnAgain'].visible = false;\r\n        this.self['BtnNo'].visible = false;\r\n        if (VictoryBox._openVictoryBoxNum > 1) {\r\n            let arr = Tools.randomNumOfArray([0, 1, 2, 3, 4, 5, 6, 7, 8], 3);\r\n            for (let index = 0; index < arr.length; index++) {\r\n                const element = arr[index];\r\n                VictoryBox.setBoxProperty('box' + arr[index], VictoryBox.BoxProperty.ads, true);\r\n            }\r\n        }\r\n    }\r\n    victoryBoxEventReg() {\r\n        EventAdmin.reg(VictoryBox.EventType.openBox, this, (dataSource) => {\r\n            console.log(dataSource, VictoryBox._defaultOpenNum);\r\n            if (VictoryBox._defaultOpenNum > 0) {\r\n                if (dataSource[VictoryBox.BoxProperty.ads]) {\r\n                    ADManager.ShowReward(() => {\r\n                        ADManager.TAPoint(TaT.BtnClick, 'Adboxvideo');\r\n                        this.getRewardFunc(dataSource);\r\n                    });\r\n                }\r\n                else {\r\n                    this.getRewardFunc(dataSource);\r\n                }\r\n            }\r\n            else {\r\n                Dialog.createHint_Middle(Dialog.HintContent[\"观看广告可以获得三次开宝箱次数！\"]);\r\n            }\r\n        });\r\n    }\r\n    getRewardFunc(dataSource) {\r\n        VictoryBox._alreadyOpenNum++;\r\n        let automan = false;\r\n        if (VictoryBox._alreadyOpenNum === 9 && !EasterEgg.getProperty(EasterEgg.Classify.EasterEgg_01, EasterEgg.Name.assembly_4, EasterEgg.Property.complete)) {\r\n            EasterEgg.doDetection(EasterEgg.Classify.EasterEgg_01, EasterEgg.Name.assembly_4, 1);\r\n            let cell = VictoryBox._BoxList.getCell(dataSource.arrange - 1);\r\n            let Automan = cell.getChildByName('Automan');\r\n            Automan.visible = true;\r\n            automan = true;\r\n        }\r\n        VictoryBox._defaultOpenNum--;\r\n        VictoryBox._selectBox = dataSource[VictoryBox.BoxProperty.name];\r\n        let diffX = dataSource.arrange % 3;\r\n        if (diffX == 0) {\r\n            diffX = 3;\r\n        }\r\n        let diffY = Math.floor(dataSource.arrange / 3 + 0.5);\r\n        let x = VictoryBox._BoxList.x + VictoryBox._BoxList.width / 3 * diffX - 45;\r\n        let y = VictoryBox._BoxList.y + VictoryBox._BoxList.height / 3 * diffY + 92;\r\n        Effects.createExplosion_Rotate(this.self, 25, x, y, 'star', 10, 15);\r\n        VictoryBox.setBoxProperty(dataSource[VictoryBox.BoxProperty.name], VictoryBox.BoxProperty.openState, true);\r\n        if (!automan) {\r\n            Laya.timer.frameOnce(20, this, f => {\r\n                Gold.getGoldAni_Heap(Laya.stage, 15, 88, 69, 'UI/GameStart/qian.png', new Laya.Point(Laya.stage.width / 2, Laya.stage.height / 2), new Laya.Point(Gold.GoldNode.x - 80, Gold.GoldNode.y), null, () => {\r\n                    Gold.addGold(VictoryBox.getBoxProperty(dataSource.name, VictoryBox.BoxProperty.rewardNum));\r\n                });\r\n            });\r\n        }\r\n        EventAdmin.notify(Task.EventType.victoryBox);\r\n    }\r\n    boxList_Update(cell, index) {\r\n        let dataSource = cell.dataSource;\r\n        let Select = cell.getChildByName('Select');\r\n        if (VictoryBox._selectBox === dataSource[VictoryBox.BoxProperty.name]) {\r\n            Select.visible = true;\r\n        }\r\n        else {\r\n            Select.visible = false;\r\n        }\r\n        let Num = cell.getChildByName('Num');\r\n        let Pic_Gold = cell.getChildByName('Pic_Gold');\r\n        let Pic_Box = cell.getChildByName('Pic_Box');\r\n        let BordPic = cell.getChildByName('BordPic');\r\n        if (!dataSource[VictoryBox.BoxProperty.openState]) {\r\n            if (dataSource[VictoryBox.BoxProperty.ads]) {\r\n                Pic_Box.skin = 'UI/VictoryBox/baoxian_adv.png';\r\n            }\r\n            else {\r\n                Pic_Box.skin = 'UI/VictoryBox/baoxian2.png';\r\n            }\r\n            Pic_Box.visible = true;\r\n            Pic_Gold.visible = false;\r\n            Num.visible = false;\r\n            BordPic.skin = 'UI/Common/kuang2.png';\r\n        }\r\n        else {\r\n            Pic_Box.visible = false;\r\n            Pic_Gold.visible = true;\r\n            Num.visible = true;\r\n            Num.text = dataSource[VictoryBox.BoxProperty.rewardNum];\r\n            BordPic.skin = 'UI/Common/kuang1.png';\r\n        }\r\n    }\r\n    victoryBoxBtnClick() {\r\n        Click.on('largen', this.self['BtnNo'], this, null, null, this.btnNoUp, null);\r\n        Click.on('largen', this.self['BtnAgain'], this, null, null, this.btnAgainUp, null);\r\n    }\r\n    btnOffClick() {\r\n        Click.off('largen', this.self['BtnNo'], this, null, null, this.btnNoUp, null);\r\n        Click.off('largen', this.self['BtnAgain'], this, null, null, this.btnAgainUp, null);\r\n    }\r\n    btnNoUp(event) {\r\n        lwg.Admin._openScene(lwg.Admin.SceneName.UIVictory, null, null, null);\r\n        this.self.close();\r\n    }\r\n    btnAgainUp(event) {\r\n        ADManager.TAPoint(TaT.BtnClick, 'ADrewardbt_box');\r\n        ADManager.TAPoint(TaT.BtnClick, 'Adboxagain');\r\n        if (VictoryBox._alreadyOpenNum < 9 && VictoryBox._adsMaxOpenNum > 0) {\r\n            ADManager.ShowReward(() => {\r\n                Dialog.createHint_Middle(Dialog.HintContent[\"增加三次开启宝箱次数！\"]);\r\n                VictoryBox._defaultOpenNum += 3;\r\n                VictoryBox._adsMaxOpenNum -= 3;\r\n            });\r\n        }\r\n        else {\r\n            Dialog.createHint_Middle(Dialog.HintContent[\"没有宝箱领可以领了！\"]);\r\n        }\r\n    }\r\n    victoryOnUpdate() {\r\n        if (VictoryBox._defaultOpenNum > 0) {\r\n            this.self['BtnAgain'].visible = false;\r\n            this.self['BtnNo'].visible = false;\r\n        }\r\n        else {\r\n            this.self['BtnAgain'].visible = true;\r\n            this.self['BtnNo'].visible = true;\r\n        }\r\n    }\r\n}\r\n",
  "references": [
    "D:/Game/project/CutHair/Project/CutHair/src/script/Lwg_Template/lwg.ts",
    "D:/Game/project/CutHair/Project/CutHair/src/script/TJ/Admanager.ts",
    "D:/Game/project/CutHair/Project/CutHair/src/script/Lwg_Template/EasterEgg.ts"
  ]
}
